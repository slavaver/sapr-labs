---
title: "SQLite"
description: "SQLite"
sidebar:
  order: 8
---

**Цель**: изучить работу с SQLite и пагинацией.

## Содержание и порядок выполнения лабораторной работы:

1. Повторить язык запросов SQL, изучить основы SQLite и работу с этой СУБД в node.js.
1. Продолжить работу на ветке из прошлого занятия и дописать новый функционал.
1. Установить пакет sqlite3 для интеграции с SQLite.
1. Создать файл example.sql, в котором описать команды для создания таблиц names и comments. И наполнением их 3 пользователями и 15 комментариями. В таблице имен хранятся только имена, и они должны быть уникальны, в комментариях храниться текст комментария и время его добавления и связь с тем, кто его написал.
1. Используя утилиту sqlite3 создать файл базы данных SQLite с именем comments.db в каталоге проекта. Созданный файл добавить в .gitignore.
1. Используя функцию .read() в утилите sqlite3 наполнить БД тестовыми данными.
1. Добавить папку services, в которой будут находиться файлы js с функциями для работы с БД.
1. POST-запрос на `/comments` теперь должен добавлять новый комментарий в БД. Требуется на стороне сервера добавить и информацию о времени добавления. А в качестве ответа отправляется последний добавленный комментарий {имя, текст, время}.
1. GET-запрос на `/lastcomment.html` возвращает последний комментарий в виде html страницы, но требуется добавить информацию о времени добавления комментария.
1. GET-запрос на `/comments`, теперь должен уметь обрабатывать строки запросов URL, например `/comments?page=2&limit=5`.
   - Пагинация обычно включает в себя два ключевых параметра номер страницы (page): указывает конкретную страницу данных, которую необходимо получить. Каждая страница содержит подмножество всего набора данных. И количество на страницу (limit): указывает максимальное количество элементов для отображения на каждой странице.
   - Разберите входящий HTTP-запрос, чтобы извлечь параметры пагинации. В node.js для этой задачи есть модуль querystring.
   - Использовать эти параметры в сервисе для запроса к базе данных SQLite и извлечения соответствующего подмножества комментариев.
   - Отправить заданное количество комментариев клиенту в качестве ответа в формате JSON. Пример ответа ниже.

1. Модуль sqlite3 использует функции обратного вызова, для перехода на объекты promise можно использовать из модуля util функцию promisify.
1. Требуется обработать ошибки, которые могут возникнуть при работе с БД.
1. Добавить новые тесты в файл .http и протестировать весь функционал.

```json
{
    "page": 1,
    "limit": 10,
    "totalPages": 3,
    "comments": [
        {"id": 1, "comment": "Great work!", "name": "John Doe", "time": "2024-03-20T10:30:00Z"},
        {"id": 2, "comment": "Interesting article.", "name": "Jane Smith", "time": "2024-03-20T11:15:00Z"},
        ...
    ]
}
```

"page": Номер текущей страницы.

"limit": Максимальное количество комментариев на странице.

"totalPages": Общее количество страниц с учетом имеющихся комментариев и указанного ограничения.

"comments": Массив, содержащий комментарии на странице, каждый из которых представлен в виде объекта с полями id, comment, name и time. "time": Временная метка, указывающая, когда был добавлен комментарий, отформатированная в ISO 8601.

## Результаты выполнения лабораторной работы:

Работающий локально сервер с логикой, которая соответствует требованиям. Код отформатирован, не содержит ошибок и замечаний от статического анализа кода ESLint, сохранен в системе контроля версий.

## Источники

1. [Скачивание SQLite](https://www.sqlite.org/download.html)
1. [Введение в SQLite](https://metanit.com/sql/sqlite/1.1.php)
1. [SQLite Tutorial](https://www.sqlitetutorial.net/)
1. [SQLite Node.js](https://www.sqlitetutorial.net/sqlite-nodejs/)
1. [How To Use SQLite with Node.js on Ubuntu](https://www.digitalocean.com/community/tutorials/how-to-use-sqlite-with-node-js-on-ubuntu-22-04)
1. [Практическая шпаргалка SQL (SQLite) с готовыми запросами](https://habr.com/ru/articles/792630/)
1. [Node.js - Строка запроса](https://nodejsdev.ru/api/querystring/)
1. [Официальный сайт Node](https://nodejs.org/en/)
1. [Введение в Node на русском](https://nodejsdev.ru/guides/)
1. [Руководство по Node на русском (PDF)](https://ruvds.com/img/other/ee86eb4f-db9f-48d3-8094-c76e14414678.pdf)
1. [Курс по Node](https://habr.com/ru/post/485294/)

## Вопросы для защиты

1. Какую роль играют сервисы и где их зона ответственности?
1. Что такое пагинация и почему она важна в веб-приложениях.
1. Что такое строка запроса?
1. Как можно реализовать пагинацию.
1. Как время форматируется в ISO 8601?
1. Что делает util.promisify?
1. SQL запросы на чтение данных с ограничениями, вставку данных.
1. SQL запросы для создания таблиц и связей в SQLite.
1. Основные типы данных в SQLite.
