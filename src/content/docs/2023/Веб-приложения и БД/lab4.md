---
title: "Node.js сервер"
description: "Node.js сервер"
sidebar:
  order: 5
---

**Цель**: изучить основы работы с Node.

## Содержание и порядок выполнения лабораторной работы:

1. Изучить:
   - http запрос и ответ,
   - основные коды статусов http,
   - часто встречающиеся заголовки запросов/ответов,
   - формат JSON,
   - обратные вызовы и события (EventEmitter) в Node,
   - документацию модуля node:http.
1. В файле package.json в script добавить новую команду или изменить текущий dev на `node --watch ./main.js`, что позволит не перезапускать сервер вручную в процессе работы. Также добавить команду "serve" для запуска основного файла в качестве сервиса.
1. Создать основной файл приложения.
1. С помощью модуля http создать сервер, который на определенные события в консоль выводит сообщения:
   - о начале работы, ip и номер порта,
   - при открытии нового подключения к нему,
   - при получении любого запроса.
1. Обработать get-запрос на корневой путь `/` и в ответе вернуть приветствие в виде простого текста (код 200, тип контента text/plain).
1. Обработать post-запрос на `/comments`. В теле запроса ожидается комментарий в формате JSON с обязательными ключами name и comment. Если все в порядке, то комментарий надо добавить к массиву в глобальной переменной, а в ответе вернуть обновленный список комментариев в том же формате json (код 200, тип контента application/json). Для получения данных из тела запроса понадобится у объекта запроса следить за событиями data и end.
1. Обработать get-запрос на `/stats` и в ответе вернуть html документ с таблицей, где в одной колонке user-agent, а во второй количество запросов (код 200, тип контента text/html). Чтобы накапливать статистику, храните все запросы в виде глобального объекта, где ключ это user-agent, а значение количество, запросов.
1. При запросах на другие пути или при неверных данных в теле запроса, необходимо возвращать 400 Bad Request.
1. Зафиксировать результаты работы в системе контроля версий на github.
1. Для тестирования установить расширение REST Client. Можно использовать программу Postman или альтернативы. Если вы используете REST Client, то создайте файл `.http` и запишите в нем запросы и проверьте корректность ответов, выводов в консоль. Для тестирования опишите варианты как корректных запросов, так и ошибочных, чтобы убедиться что ваш сервер всегда работает корректно.

### Пример записи в файле `.http`

```
GET /users HTTP/1.1
Host: 127.0.0.1:3000

###

GET /users/2 HTTP/1.1
Host: 127.0.0.1:3000
```

## Результаты выполнения лабораторной работы:

Работающий локально сервер с логикой, которая соответствует требованиям. Код отформатирован, не содержит ошибок и замечаний от статического анализа кода ESLint, сохранен в системе контроля версий.

## Источники

1. [Официальный сайт Node](https://nodejs.org/en/)
1. [Введение в Node на английском](https://nodejs.dev/en/learn/)
1. [Введение в Node на русском](https://nodejsdev.ru/guides/)
1. [Руководство по Node на русском (PDF)](https://ruvds.com/img/other/ee86eb4f-db9f-48d3-8094-c76e14414678.pdf)
1. [Курс по Node](https://habr.com/ru/post/485294/)
1. [JSON](https://doka.guide/tools/json/)

## Вопросы для защиты

1. Что такое node.js
1. npm - назначение и основные команды
1. package.json - назначение и основные свойства
1. Польза от .gitignore
1. Способы проверки работоспособности сервера
1. Создание минимального сервера на node.js
1. Объекты запроса и ответа - свойства, методы
1. Получение данных из тела запроса.
1. Примеры заголовков http.
1. Коды и статусы в http.
