---
title: "Рефакторинг"
description: "Рефакторинг"
sidebar:
  order: 7
---

**Цель**: изучить работу с классами в js, переписать имеющийся код с использованием классов и добавлением абстрактности.

## Содержание и порядок выполнения лабораторной работы:

Изучить объявление классов, создание экземпляров классов, использование функции конструктора, публичные и приватные поля и методы.

В этом задании упор делается на организацию и удобство в работе с кодом и упрощением добавления новых путей и методов, с которыми может работать сервер. Для этого потребуется создать классы для приложения и шаблонизатора. И часть логики выделить в контроллеры.

### Класс приложения

- В отдельном файле объявите класс `VanillaApp`, который инкапсулирует логику настройки и работы сервера.
- Используйте встроенный в Node.js модуль `http` для создания HTTP-сервера.
- Реализуйте метод `add` в классе `VanillaApp`, который позволяет добавлять новые url и методы HTTP.
- Реализуйте метод `listen`, который запускает сервер на указанном порту и хосте.
- Реализуйте метод `static`, который позволяет возвращать статические файлы из папки в качестве ответа.
- Рассмотрите возможность использования объекта или map для хранения обработчиков маршрутов (url + метод) и соответствующих им функций.

### Класс шаблонизатора

- В отдельном файле объявите класс `TemplateEngine`, который инкапсулирует логику шаблонизации: санитизация html и расчет длины контента.
- Реализуйте статический метод `compile` в классе `TemplateEngine`, который возвращает объект с уже обработанным html и рассчитанной длиной контента.

### Контроллеры

- Далее код нашего приложения будет разделен на слои и контроллеры - это первый слой. Задача контроллера (функции) заключается в работе с объектами запроса и ответа, то есть он должен в итоге подготовить корректный ответ для клиента и в будущем он будет вызывать сервисы для получения данных из БД.
- Функции, которые вы передаете в качестве аргумента в метод add, теперь должны храниться в отдельном файле в папке `controllers` и быть импортированы в main.js.
- Сами контроллеры при вызове должны получать в качестве аргументов объекты запроса и ответа.

### Пример файла main.js

```js
import { Server } from './server.js'
import { TemplateEngine } from './templateEngine.js'
import { rootGetController, rootPostController } from './controllers/rootControllers.js'

const PORT = 5500
const HOST = '127.0.0.1'
const FILES = { ...}

const myServer = new Server()

myServer.static(FILES)

myServer.add('GET', '/', rootGetController)
myServer.add('POST', '/', rootPostController)
myServer.add('GET', '/comment', (req, res) => {
  const sanitizedHtml = TemplateEngine.compile(template, data)
  res.setHeader('Content-Length', sanitizedHtml.biteLength)
  res.writeHead(200)
  res.end(sanitizedHtml.html)
})

myServer.listen(PORT, HOST, () => {
  console.log(`Server is running on http://${HOST}:${PORT}`);
})
```

### Тестирование

После рефакторинга должен работать весь функционал из предыдущей работы. Тесты для сервера у вас уже написаны, используйте их для проверки работоспособности кода.

## Результаты выполнения лабораторной работы:

Работающий локально сервер с логикой, которая соответствует требованиям. Код отформатирован, не содержит ошибок и замечаний от статического анализа кода ESLint, сохранен в системе контроля версий.

## Источники

1. [learn.javascript.ru: Классы](https://learn.javascript.ru/classes)
1. [MDN: Классы](https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Classes)
1. [Официальный сайт Node](https://nodejs.org/en/)
1. [Введение в Node на английском](https://nodejs.dev/en/learn/)
1. [Введение в Node на русском](https://nodejsdev.ru/guides/)
1. [Руководство по Node на русском (PDF)](https://ruvds.com/img/other/ee86eb4f-db9f-48d3-8094-c76e14414678.pdf)
1. [Курс по Node](https://habr.com/ru/post/485294/)
1. [JSON](https://doka.guide/tools/json/)

## Вопросы для защиты

1. Как объявить новый класс в js?
1. Когда вызывается функция конструктор?
1. Как создать новый экземпляр класса?
1. Какую задачу решают контроллеры?
1. Опишите работу this в классе.
1. Приватные и публичные поля.
1. Приватные и публичные методы.
1. Статические методы класса.
