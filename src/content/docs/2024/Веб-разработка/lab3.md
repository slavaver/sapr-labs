---
title: "Node.js сервер"
description: "Node.js сервер"
sidebar:
  order: 4
---

**Цель**: изучить основы работы с Node и http модулем.

## Содержание и порядок выполнения лабораторной работы:

### Изучите

- http запрос и ответ,
- основные коды статусов http,
- часто встречающиеся заголовки запросов/ответов,
- формат JSON,
- обратные вызовы и события (EventEmitter) в Node,
- документацию модуля node:http.

### Добавьте правила для ESLint

1. Установите плагин для правил Node `npm install --save-dev eslint-plugin-n`.
1. Дополните конфигурацию eslint.config.js строкой `nodePlugin.configs["flat/recommended-module"]`. [Пример для eslint-plugin-n](https://www.npmjs.com/package/eslint-plugin-n).
1. Дополните конфигурацию eslint.config.js правилами приведенными ниже. Пример организации конфигурационного файла смотрите в [документации ESLint](https://eslint.org/docs/latest/use/getting-started#configuration).

```js
{
   rules: {
      // Possible Problems
      "no-template-curly-in-string": "error",
      "no-use-before-define": ["error", { functions: false }],
      "no-useless-assignment": "error",
      // Suggestions
      "accessor-pairs": "error",
      "arrow-body-style": ["error", "as-needed"],
      camelcase: "error",
      curly: "error",
      eqeqeq: ["error", "always"],
      "no-alert": "error",
      "no-console": "error",
      "no-nested-ternary": "error",
      "no-return-assign": "error",
      "no-shadow": ["error", { hoist: "all" }],
      "no-unneeded-ternary": "error",
      "no-unused-expressions": "error",
      "no-useless-concat": "error",
      "no-useless-return": "error",
      "no-var": "error",
      "prefer-arrow-callback": "error",
      "prefer-const": "error",
      "prefer-template": "error",
      radix: "error",
    },
}
```

### Проверьте package.json

1. Убедитесь что в package.json в script у вас есть команда `node --watch ./main.js`. Имя файла у вас может отличаться. Научитесь запускать проект с ее помощью, чтобы не перезапускать сервер вручную в процессе работы. Также добавить команду "serve" для запуска основного файла в качестве сервиса.

### Выполнение задания

1. Для тестирования установить расширение REST Client. Можно использовать Postman или альтернативы.
1. Если вы используете REST Client, то создайте файл `.http` и запишите в нем запросы под описание в таблице и комментарий под ней. Для будущего тестирования опишите варианты как корректных запросов, так и ошибочных, чтобы убедиться что ваш сервер всегда работает корректно.

| Метод | Путь      | Описание                                                                                                                                                                                                                                                                                                   |
| ----- | --------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| GET   | /         | В ответе возвращается приветствие в виде простого текста (код 200, тип контента text/plain).                                                                                                                                                                                                               |
| GET   | /comments | Возвращает все накопленные комментарии в виде массива в формате JSON с полями idx, name и comment (код 200, тип контента application/json).                                                                                                                                                                |
| POST  | /comments | В теле запроса ожидается комментарий в формате JSON с **обязательными** полями name и comment. Если все в порядке, то комментарий надо добавить к массиву в глобальной переменной, а в ответе вернуть данные в формате JSON с полями idx, name и comment (код 201 Created, тип контента application/json). |
| GET   | /stats    | В ответе вернуть html документ с таблицей, где в одной колонке user-agent, а во второй количество запросов (код 200, тип контента text/html). Чтобы накапливать статистику, храните все запросы в виде глобального объекта, где ключ это user-agent, а значение количество запросов.                       |

При запросах на другие пути или при неверных данных в теле запроса, необходимо возвращать 400 Bad Request.

1. Создайте основной файл приложения. Его название вы могли в том числе указать в package.json.
1. С помощью модуля http создайте сервер, который на определенные события в консоль выводит сообщения:

   - о начале работы - ip и номер порта,
   - при открытии нового подключения к нему,
   - при получении любого запроса.

1. Сервер также обрабатывает запросы описанные в таблице выше. Для получения данных из тела запроса понадобится у объекта запроса следить за событиями data и end.
1. С помощью запросов описанных в файле `.http` проверьте корректность ответов сервера и его выводов в консоль.
1. Зафиксируйте результаты работы в системе контроля версий на github.

### Пример записи в файле `.http`

```
GET /stats HTTP/1.1
Host: 127.0.0.1:3000

###

POST /user HTTP/1.1
Host: 127.0.0.1:3000
Content-Type: application/json

{
  "name": "User"
}
```

## Требования к коду и результат выполнения

- Код отформатирован, не содержит ошибок и замечаний от статического анализа кода ESLint, сохранен в системе контроля версий.
- Отсутствуют ошибки в консоли.
- Работающий локально сервер с логикой, которая соответствует требованиям задания.
- Сервер проходит все тесты.

## Источники

1. [Официальный сайт Node](https://nodejs.org/en/)
1. [Введение в Node на английском](https://nodejs.dev/en/learn/)
1. [Введение в Node на русском](https://nodejsdev.ru/guides/)
1. [Руководство по Node на русском (PDF)](https://ruvds.com/img/other/ee86eb4f-db9f-48d3-8094-c76e14414678.pdf)
1. [Курс по Node](https://habr.com/ru/post/485294/)
1. [JSON](https://doka.guide/tools/json/)
1. [Evolution of HTTP](https://developer.mozilla.org/en-US/docs/Web/HTTP/Evolution_of_HTTP)

## Вопросы для защиты

1. Что такое node.js.
1. Отличия версий HTTP.
1. Структура сообщений протокола HTTP.
1. Примеры http статус-кодов и заголовков.
1. Объекты запроса и ответа в node\:http - свойства, методы.
1. Получение данных из тела запроса в node\:http.
1. Формат данных JSON.