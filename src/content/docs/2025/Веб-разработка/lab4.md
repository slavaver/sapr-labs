---
title: "3D-редактор"
description: "Создание моделей рисованием на canvas и Three.js"
sidebar:
  order: 5
---

**Цель**: Разработать веб-приложение для создания низкополигональных 3D-моделей на основе рисования двумерных проекций.

## Подготовка

Изучите метод пространственного отсечения (Space Carving). Его суть заключается в том, что изначально 3D-пространство представляет собой цельный куб из вокселей (трехмерных пикселей). Если на любой из трех 2D-проекций (спереди, сбоку или сверху) пиксель стерт, соответствующий ему ряд вокселей в 3D-пространстве удаляется.

Изучите способ удаления внутренних граней через отбраковку воксельных граней (Voxel Face Culling) или удалением скрытых поверхностей (Hidden Surface Removal). Каждый блок в трехмерной сетке имеет ровно 6 граней: верхнюю, нижнюю, левую, правую, переднюю и заднюю. Правило отбора простое: рисуется грань только в том случае, если пространство непосредственно рядом с ней пустое. Если блок существует в координатах (x, y, z), вы проверяете его соседа справа в координатах (x+1, y, z). Если там есть другой блок, вы не создаете правую грань текущего блока, потому что она полностью скрыта.

## Выполнение

Продолжайте работу на ветке frontend.

Создайте макет страницы, состоящий из четырех основных панелей одинакового размера: вид сверху, вид спереди, вид слева и окно 3D-просмотра. Разместите панель инструментов (переключатель режимов, выбор цвета, очистка холстов). Для создания настроя и стиля можете использовать NES.css или подобное.

Настройте три элемента canvas для проекций. Реализуйте отрисовку фоновой сетки (grid), определяющей разрешение вашей будущей модели (например, 16x16 или 32x32 пикселя). Добавьте синхронизированное перекрестие: когда пользователь водит мышью по одной проекции, на двух других должны отображаться линии или маркеры, показывающие ту же координату (ось).

Реализуйте первый режим работы приложения. В этом режиме рисование на Canvas (левой кнопкой — добавление, правой — стирание) определяет только форму объекта. Создайте единый трехмерный массив данных (матрицу), представляющий сетку вокселей. Напишите функцию, которая при каждом изменении 2D-холстов проходит по этому массиву и применяет алгоритм Space Carving, обновляя структуру формы.

Реализуйте второй режим. В нем форма модели блокируется (изменять силуэт нельзя), но пользователь может выбрать цвет из палитры и наносить его на видимые части модели. Продумайте механику окрашивания: это может быть клик непосредственно по 3D-модели (с использованием выпускания лучей — Raycasting) или раскрашивание через те же 2D-проекции, где цвет применяется к первому видимому на этой оси вокселю.

Свяжите полученный массив вокселей с Three.js. Напишите алгоритм Face Culling, который будет проверять соседей каждого существующего вокселя и создавать геометрию только для тех граней, которые "смотрят" наружу. Подключите OrbitControls, чтобы модель в четвертой панели можно было свободно вращать, приближать и отдалять мышью.

## Требования к коду и результат выполнения

- Код отформатирован, сохранен в системе контроля версий.
- Отсутствуют ошибки в консоли.
- Код разбит на логические модули (отдельно логика интерфейса, отдельно работа с 2D, отдельно математика вокселей, отдельно 3D-рендеринг).
